C51 COMPILER V9.60.0.0   DWIN_PERIPHERALS                                                  12/10/2025 16:37:04 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DWIN_PERIPHERALS
OBJECT MODULE PLACED IN .\obj\DWIN_PERIPHERALS.obj
COMPILER INVOKED BY: C:\KeilC51\C51\BIN\C51.EXE DWIN_PERIPHERALS.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\T5L51) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\DWIN_PERIPHERALS.lst) OBJECT(.\obj\DWIN_PERIPHERALS.obj)

line level    source

   1          /**
   2           * @file DWIN_PERIPHERALS.C
   3           * @brief Wrapper funkcije za kontrolu DWIN T5L periferija (PWM, ADC, LED, RTC).
   4           * @details Koristi implementacije DGUS VP pristupa (read_dgus_vp/write_dgus_vp) iz sys.c/sys.h.
   5           * Svi upisi i citanja se vrse u 'Word' (u16) formatu.
   6           */
   7          
   8          #include "sys.h" // Ukljucuje i T5LOS8051.h
   9          #include "DWIN_GUI_VP.H"
  10          
  11          // =========================================================================
  12          // 2. ADC FUNKCIJE (Analog-to-Digital Converter)
  13          // =========================================================================
  14          
  15          /**
  16           * @brief Čita trenutnu 16-bitnu sirovu AD vrednost sa specifičnog kanala (AD0-AD7).
  17           * @details Koristi VP_ADC_INSTANT (0x0032). Svaki kanal zauzima 1 Word (2 bajta).
  18           * @param channel: Broj ADC kanala (0 do 7).
  19           * @param raw_value_ptr: Pointer na u16 varijablu gde ce biti smestena ocitana vrednost.
  20           * @return u8 (0 - OK, 1 - Greska)
  21           */
  22          u8 ADC_Read_Raw(u8 channel, u16* raw_value_ptr) {
  23   1          u32 address;
  24   1      
  25   1          if (channel > 7 || raw_value_ptr == NULL) {
  26   2              return 1; 
  27   2          }
  28   1          
  29   1          // Adresa = VP_ADC_INSTANT (0x0032) + channel * 2 (Word adresa)
  30   1          address = VP_ADC_INSTANT + (u32)channel * 2;
  31   1          
  32   1          // Citamo 1 Word (2 bajta)
  33   1          read_dgus_vp(address, raw_value_ptr, 2);
  34   1          
  35   1          return 0;
  36   1      }
  37          
  38          // =========================================================================
  39          // 3. LED/BACKLIGHT FUNKCIJE
  40          // =========================================================================
  41          
  42          /**
  43           * @brief Postavlja trenutnu osvetljenost pozadinskog svetla.
  44           * @details Koristi VP_LED_CONFIG (0x0082). Pise se u Low Byte (D0).
  45           * @param brightness: Vrednost osvetljenosti (0x00 do 0x64, tj. 0% do 100%).
  46           * @return u8 (0 - OK)
  47           */
  48          u8 LED_Set_Brightness_Now(u8 brightness) {
  49   1      
  50   1          write_dgus_vp(VP_LED_CONFIG, &brightness, 1);
  51   1          return 0;
  52   1      }
  53          
  54          /**
C51 COMPILER V9.60.0.0   DWIN_PERIPHERALS                                                  12/10/2025 16:37:04 PAGE 2   

  55           * @brief TEST KOMANDA: Postavlja osvetljenost pozadinskog svetla na 50% (0x32).
  56           * @details Koristi VP_LED_CONFIG (0x0082).
  57           * @return void
  58           */
  59          void LED_Test_Set_50_Percent(void) {
  60   1          u8 brightness = 0x32; 
  61   1          LED_Set_Brightness_Now(brightness);
  62   1      }
  63          
  64          // =========================================================================
  65          // 4. RTC FUNKCIJE (Real-Time Clock)
  66          // =========================================================================
  67          
  68          /**
  69           * @brief Pisanje datuma i vremena u RTC DGUS registre.
  70           * @details Koristi VP_RTC (0x0010). Upisuje 8 bajtova (4 Worda)
  71           * koji sadrže vreme.
  72           * @param rtc_data: Struktura koja sadrzi sve komponente vremena/datuma.
  73           * @return u8 (0 - OK)
  74           */
  75          u8 RTC_Set_Time_DGUS(rtc_time rtc_data) {
  76   1          // VP_RTC (0x0010) je 4 Worda (8 bajta)
  77   1          // Struktura rtc_time je vec alinjirana (8 bajtova)
  78   1          // 
  79   1          // Format upisa (u bajtovima): Year, Month, Day, Week, Hour, Min, Sec, Res
  80   1          // Write 4 Word-a (8 bajtova)
  81   1          write_dgus_vp(VP_RTC, &rtc_data, 8); 
  82   1          return 0;
  83   1      }
  84          
  85          /**
  86           * @brief Čitanje datuma i vremena iz RTC DGUS registara.
  87           * @details Koristi VP_RTC (0x0010). Čita 8 bajtova (4 Worda).
  88           * @param rtc_data_ptr: Pointer na strukturu gde ce biti smesteni podaci.
  89           * @return u8 (0 - OK)
  90           */
  91          u8 RTC_Read_Time_DGUS(rtc_time* rtc_data_ptr) {
  92   1          // Citamo 4 Word-a (8 bajtova)
  93   1          read_dgus_vp(VP_RTC, rtc_data_ptr, 8);
  94   1          return 0;
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    176    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      12
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
